"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),_get=function(e,t,n){for(var s=!0;s;){var a=e,r=t,i=n;o=l=u=void 0,s=!1,null===a&&(a=Function.prototype);var o=Object.getOwnPropertyDescriptor(a,r);if(void 0!==o){if("value"in o)return o.value;var u=o.get;return void 0===u?void 0:u.call(i)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;e=l,t=r,n=i,s=!0}},ImplemetationError=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),t}(Error),DeviceNotFoundError=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),t}(Error),BinarioUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"byteArrayToHex",value:function(e){var t=" ",n=!0,s=!1,a=void 0;try{for(var r,i=e[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var o=r.value;t+=o.toString(16).toUpperCase()+" "}}catch(u){s=!0,a=u}finally{try{!n&&i["return"]&&i["return"]()}finally{if(s)throw a}}return"["+t+"]"}}]),e}(),MidiMessageTester=function(){function e(t){_classCallCheck(this,e),this.message=t}return _createClass(e,[{key:"init",value:function(){return this.tests=new Tests,this}},{key:"test",value:function(){return this.tests.finalResult()}},{key:"isLessThen",value:function(e){return this.tests.add(this.message.length<e.length),this}},{key:"startingWith",value:function(e){if(!(e.length<=this.message.length))return this.tests.add(!1),this;for(var t=0;t<e.length;t++)e[t]!=this.message[t]&&this.tests.add(!1);return this.tests.add(!0),this}},{key:"sizeIs",value:function(e){return this.tests.add(this.message.length==e),this}},{key:"endingWith",value:function(e){if(!(e.length<=this.message.length))return this.tests.add(!1),this;for(var t=1;t<=e.length;t++)e[e.length-t]!=this.message[this.message.length-t]&&this.tests.add(!1);return this.tests.add(!0),this}}]),e}(),Tests=function(){function e(){_classCallCheck(this,e),this.result=!0}return _createClass(e,[{key:"add",value:function(e){0!=this.result&&(this.result=e)}},{key:"finalResult",value:function(){return this.result}}]),e}(),Optional=function(){function e(t){_classCallCheck(this,e),this.content=t}return _createClass(e,[{key:"isPresent",value:function(){return null!==this.content}},{key:"get",value:function(){if(!this.isPresent())throw new Error("NullPointerException");return this.content}}],[{key:"of",value:function(t){return new e(t)}},{key:"empty",value:function(){return new e(null)}}]),e}(),MultistompChanger=function(){function e(t){_classCallCheck(this,e),this.controller=t}return _createClass(e,[{key:"attempt",value:function(e){if(console.log(e),e.is(CommonCause.TO_PATCH))this.controller.toPatch(e.details.patch);else if(e.is(CommonCause.ACTIVE_EFFECT)&&e.details.patch==Details.NULL)this.controller.activeEffect(e.details.effect);else if(e.is(CommonCause.ACTIVE_EFFECT)&&e.details.patch!=Details.NULL)this.controller.multistomp().patchs().get(e.details.patch).effects().get(e.details.effect).active();else if(e.is(CommonCause.DISABLE_EFFECT)&&e.details.patch==Details.NULL)this.controller.disableEffect(e.details.effect);else if(e.is(CommonCause.DISABLE_EFFECT)&&e.details.patch!=Details.NULL)this.controller.multistomp().patchs().get(e.details.patch).effects().get(e.details.effect).disable();else if(e.is(CommonCause.SET_PARAM)){var t=e.details.effect,n=e.details.param,s=e.details.value;this.controller.setEffectParam(t,n,s)}}}]),e}(),PedalCompany=function(){function e(t){_classCallCheck(this,e),this.name=t}return _createClass(e,[{key:"getName",value:function(){return this.name}},{key:"toString",value:function(){return this.name}}]),e}();PedalCompany.NULL=new PedalCompany("Unknown Company"),PedalCompany.ZoomCorp=new PedalCompany("Zoom Corporation"),PedalCompany.Line6=new PedalCompany("Line 6"),PedalCompany.Roland=new PedalCompany("Roland Corporation");var PedalController=function(){function e(t){_classCallCheck(this,e),this.controllerListenners=new Array,this.realMultistompListenners=new Array,this.realChange=!1,this.started=!1,this.pedal=t,this.connection=new MidiConnection(t,t.getPedalType()),this.connection.setListenner(this),this.pedal.addListenner(this),this.controllerListenners.push(new Log("Controller")),this.realMultistompListenners.push(new Log("Real Multistomp"))}return _createClass(e,[{key:"on",value:function(){this.started||(this.started=!0,this.connection.start(),this.connection.send(this.pedal.start()),this.realChange=!1)}},{key:"off",value:function(){this.started&&(this.started=!1,this.connection.stop())}},{key:"hasStarted",value:function(){return this.started}},{key:"multistomp",value:function(){return this.pedal}},{key:"nextPatch",value:function(){this.pedal.nextPatch()}},{key:"beforePatch",value:function(){this.pedal.beforePatch()}},{key:"toPatch",value:function(e){this.pedal.toPatch(e)}},{key:"toogleEffect",value:function(e){this.pedal.currentPatch().effects[e].toggle()}},{key:"hasActived",value:function(e){return this.pedal.currentPatch().effects[e].hasActived()}},{key:"activeEffect",value:function(e){this.pedal.currentPatch().effects[e].active()}},{key:"disableEffect",value:function(e){this.pedal.currentPatch().effects[e].disable()}},{key:"setEffectParam",value:function(e,t,n){this.pedal.currentPatch().effects[e].params[t].setValue(n)}},{key:"getAmountEffects",value:function(){return this.pedal.currentPatch().effects.length}},{key:"addListenner",value:function(e){this.pedal.addListenner(e)}},{key:"toString",value:function(){var e="State: ";return e+=started?"On":"Off",e+="\n",e+this.pedal.toString()}},{key:"onChange",value:function(e){return this.realChange?void(this.realChange=!1):(this.connection.send(e),void this.notify(this.controllerListenners,e))}},{key:"update",value:function(e){this.realChange=!0;var t=new MultistompChanger(this);e.forEach(function(e){return t.attempt(e)}),this.notify(this.realMultistompListenners,e)}},{key:"notify",value:function(e,t){var n=!0,s=!1,a=void 0;try{for(var r,i=e[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var o=r.value;o.onChange(t)}}catch(u){s=!0,a=u}finally{try{!n&&i["return"]&&i["return"]()}finally{if(s)throw a}}}},{key:"sendMessage",value:function(e){this.connection.send(e)}},{key:"send",value:function(e){this.connection.send(e),this.realChange=!0}}]),e}(),PedalControllerFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"searchPedal",value:function(){var e=!0,t=!1,n=void 0;try{for(var s,a=PedalType.values[Symbol.iterator]();!(e=(s=a.next()).done);e=!0){var r=s.value;if(this.isConnected(r))return this.getPedal(r)}}catch(i){t=!0,n=i}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw n}}return new PedalController(new NullMultistomp)}},{key:"isConnected",value:function(e){return 0!=MidiTransmition.findDevices(e).length}},{key:"getPedal",value:function(e){var t=void 0,n=e.getCompany();return t=n==PedalCompany.ZoomCorp?(new ZoomMultistompFactory).generate(e):n==PedalCompany.Roland?new NullMultistomp:(n==PedalCompany.Line6,new NullMultistomp),new PedalController(t)}}]),e}(),MidiConnection=function(){function e(t,n){_classCallCheck(this,e),this.listenner=Optional.empty(),this.multistomp=t,this.sender=new MidiSender(n),this.reader=new MidiReader(n),this.reader.setListenner(this),this.encoder=MessageEncoderFactory.For(n),this.decoder=MessageDecoderFactory.For(n)}return _createClass(e,[{key:"start",value:function(){this.sender.start(),this.reader.start()}},{key:"stop",value:function(){this.sender.stop(),this.reader.stop()}},{key:"send",value:function(e){var t=!0,n=!1,s=void 0;try{for(var a,r=this.generateMidiMessages(e)[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var i=a.value;this.sendMidiMessage(i)}}catch(o){n=!0,s=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw s}}}},{key:"generateMidiMessages",value:function(e){return this.encoder.encode(e)}},{key:"sendMidiMessage",value:function(e){console.log("MIDI sended: "),console.log(" "+BinarioUtil.byteArrayToHex(e)),this.sender.send(e)}},{key:"setListenner",value:function(e){this.listenner=Optional.of(e)}},{key:"onDataReceived",value:function(e){if(console.log("MIDI received: "),console.log(" "+BinarioUtil.byteArrayToHex(e)),!this.decoder.isForThis(e))return void console.log(" unknown ");var t=this.decoder.decode(e,this.multistomp);this.listenner.isPresent()&&this.listenner.get().update(t)}}]),e}();MidiConnection.OnUpdateListenner=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"update",value:function(e){}}]),e}();var MessageDecoderFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"For",value:function(e){if(PedalType.G3==e)return new ZoomGSeriesMessageDecoder;throw new Error("MessageDecoder not found for: "+e)}}]),e}(),MessageEncoderFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"For",value:function(e){if(PedalType.G3==e)return new ZoomGSeriesMessageEncoder;throw new Error("MessageEncoder not found for: "+e)}}]),e}(),MidiTransmition=function(){function e(t){_classCallCheck(this,e);var n=e.findDevices(t),s=this.locateDeviceIn(n);if(!s.isPresent())throw console.log("Midi "+this.deviceType()+" device not found for: "+t+" ("+t.getUSBName()+")"),new DeviceNotFoundError("Midi "+this.deviceType()+" device not found for: "+t+" ("+t.getUSBName()+")");this.device=s.get()}return _createClass(e,[{key:"locateDeviceIn",value:function(e){var t=!0,n=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var i=a.value;if(this.isThis(i))return Optional.of(i)}}catch(o){n=!0,s=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw s}}return Optional.empty()}},{key:"isThis",value:function(e){}},{key:"deviceType",value:function(){}},{key:"start",value:function(){this.device.open()}},{key:"stop",value:function(){this.device.close()}}],[{key:"findDevices",value:function(e){var t=new Array,n=void 0,s=!0,a=!1,r=void 0;try{for(var i,o=midiSystem.midiDevices[Symbol.iterator]();!(s=(i=o.next()).done);s=!0)n=i.value,n.name.includes(e.USBName)&&t.push(n)}catch(u){a=!0,r=u}finally{try{!s&&o["return"]&&o["return"]()}finally{if(a)throw r}}return t}}]),e}(),MidiSystem=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"onStart",value:function(e){this.midiInputs=e.inputs,this.midiOutputs=e.outputs,console.log("Connected")}},{key:"onError",value:function(e){console.log(e),console.log("Deu pau :/")}},{key:"midiDevices",get:function(){var e=[],t=!0,n=!1,s=void 0;try{for(var a,r=this.midiInputs.values()[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var i=a.value;e.push(i)}}catch(o){n=!0,s=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw s}}var u=!0,l=!1,c=void 0;try{for(var h,f=this.midiOutputs.values()[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var y=h.value;e.push(y)}}catch(o){l=!0,c=o}finally{try{!u&&f["return"]&&f["return"]()}finally{if(l)throw c}}return e}}]),e}(),midiSystem=new MidiSystem;window.addEventListener("load",function(){navigator.requestMIDIAccess({sysex:!0}).then(midiSystem.onStart.bind(midiSystem),midiSystem.onError.bind(midiSystem))});var MidiReader=function(e){function t(e){var n=this;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.device.onmidimessage=function(e){return n.send(e)}}return _inherits(t,e),_createClass(t,[{key:"isThis",value:function(e){return e.type==this.deviceType()}},{key:"deviceType",value:function(){return"input"}},{key:"setListenner",value:function(e){this.listenner=e}},{key:"send",value:function(e){this.listenner.onDataReceived(e.data)}}]),t}(MidiTransmition),MidiSender=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return _inherits(t,e),_createClass(t,[{key:"isThis",value:function(e){return e.type==this.deviceType()}},{key:"deviceType",value:function(){return"output"}},{key:"send",value:function(e){this.device.send(e)}}]),t}(MidiTransmition),PedalType=function(){function e(t,n,s){_classCallCheck(this,e),this.name=t,this.company=n,this.USBName=s,e.values.push(this)}return _createClass(e,null,[{key:"values",value:new Array,enumerable:!0}]),_createClass(e,[{key:"getId",value:function(){return this.id}},{key:"getCompany",value:function(){return this.company}},{key:"toString",value:function(){return this.name+" - "+this.company.toString()}},{key:"getUSBName",value:function(){return this.USBName}}]),e}();PedalType.Null=new PedalType("Unknown Pedal",PedalCompany.NULL,"Pedal Unknown is unimplemented"),PedalType.G2Nu=new PedalType("Zoom G2Nu",PedalCompany.ZoomCorp,"G2Nu/G2.1Nu"),PedalType.G3=new PedalType("Zoom G3v2.0",PedalCompany.ZoomCorp,"ZOOM G Series");var CommonCause=function e(){_classCallCheck(this,e)};CommonCause.TO_PATCH="TO_PATCH",CommonCause.GENERAL_VOLUME="GENERAL_VOLUME",CommonCause.PATCH_VOLUME="PATCH_VOLUME",CommonCause.ACTIVE_EFFECT="ACTIVE_EFFECT",CommonCause.DISABLE_EFFECT="DISABLE_EFFECT",CommonCause.SET_PARAM="SET_PARAM";var Messages=function(){function e(){_classCallCheck(this,e),this.messages=new Array}return _createClass(e,null,[{key:"Empty",value:function(){return new e}},{key:"For",value:function(){var t=new e,n=!0,s=!1,a=void 0;try{for(var r=arguments.length,i=Array(r),o=0;r>o;o++)i[o]=arguments[o];for(var u,l=i[Symbol.iterator]();!(n=(u=l.next()).done);n=!0){var c=u.value;t.addMessage(c)}}catch(h){s=!0,a=h}finally{try{!n&&l["return"]&&l["return"]()}finally{if(s)throw a}}return t}}]),_createClass(e,[{key:"addCause",value:function(e){this.addCause(e,new Details)}},{key:"addCauseDetails",value:function(e,t){this.addMessage(new Message(e,t))}},{key:"addMessage",value:function(e){this.messages.push(e)}},{key:"concatWith",value:function(e){var t=this;e.forEach(function(e){return t.addMessage(e)})}},{key:Symbol.iterator,value:function(){return this.messages[Symbol.iterator]()}},{key:"forEach",value:function(e){this.messages.forEach(e)}},{key:"get",value:function(t){var n=new e,s=!0,a=!1,r=void 0;try{for(var i,o=this[Symbol.iterator]();!(s=(i=o.next()).done);s=!0){var u=i.value;u.is(t)&&n.addMessage(u)}}catch(l){a=!0,r=l}finally{try{!s&&o["return"]&&o["return"]()}finally{if(a)throw r}}return n}},{key:"toString",value:function(){var e="",t=!0,n=!1,s=void 0;try{for(var a,r=this.messages[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var i=a.value;e+=i.toString()}}catch(o){n=!0,s=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw s}}return e}}]),e}();Messages.Details=function(){function e(){_classCallCheck(this,e),this.patch=e.NULL,this.effect=e.NULL,this.param=e.NULL,this.value=e.NULL}return _createClass(e,[{key:"toString",value:function(){var t="";return this.patch!=e.NULL&&(t+=" patch="+this.patch),this.effect!=e.NULL&&(t+=" effect="+this.effect),this.param!=e.NULL&&(t+=" param="+this.param),this.value!=e.NULL&&(t+=" value="+this.value),t}}],[{key:"NULL",value:-1,enumerable:!0}]),e}(),Messages.Message=function(){function e(t,n){_classCallCheck(this,e),void 0===n?this._MessageCause(t):this._MessageCauseDetails(t,n)}return _createClass(e,[{key:"_MessageCause",value:function(e){this._MessageCauseDetails(e,new Details)}},{key:"_MessageCauseDetails",value:function(e,t){this.cause=e,this.details=t}},{key:"details",value:function(){return this.details}},{key:"is",value:function(e){return this.cause==e}},{key:"toString",value:function(){var e=this.cause+": ("+this.details+")";return e}}]),e}();var Effect=function(){function e(t,n){_classCallCheck(this,e),this.state=!1,this.params=new Array,this.listenner=Optional.empty(),this.midiId=t,this.name=n}return _createClass(e,[{key:"getMidiId",value:function(){return this.midiId}},{key:"getName",value:function(){return this.name}},{key:"active",value:function(){this.setState(!0)}},{key:"disable",value:function(){this.setState(!1)}},{key:"toggle",value:function(){this.hasActived()?this.disable():this.active()}},{key:"setState",value:function(e){this.state=e;var t=new Details(Details.TypeChange.PEDAL_STATUS,e?1:0),n=new ChangeMessage(MultistompCause.EFFECT,this,t);this.notify(n)}},{key:"hasActived",value:function(){return this.state}},{key:"addParam",value:function(e){this.params.push(e),e.setListenner(this)}},{key:"toString",value:function(){var t=this.name+": "+this.midiId+" "+e.name+" - ";t+=this.state?"Actived":"Disabled";var n=!0,s=!1,a=void 0;try{for(var r,i=this.params[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var o=r.value;t+=o.toString()}}catch(u){s=!0,a=u}finally{try{!n&&i["return"]&&i["return"]()}finally{if(s)throw a}}return t+=")"}},{key:"setListenner",value:function(e){this.listenner=Optional.of(e)}},{key:"onChange",value:function(e){var t=new ChangeMessage(MultistompCause.SUPER,this,e);this.notify(t)}},{key:"notify",value:function(e){this.listenner.isPresent()&&this.listenner.get().onChange(e)}}]),e}(),Multistomp=function(){function e(){_classCallCheck(this,e),this.listenners=new Array,this.patchs=new Array,this.idCurrentPatch=0}return _createClass(e,[{key:"getPedalType",value:function(){}},{key:"addPatch",value:function(e){this.patchs.push(e),e.setListenner(this)}},{key:"currentPatch",value:function(){try{return this.patchs[this.idCurrentPatch]}catch(e){throw new ImplemetationError("This multistomp havent any Patch. \nAdd the Patchs in the Pedal Construtor: "+this.name)}}},{key:"getIdCurrentPatch",value:function(){return this.idCurrentPatch}},{key:"nextPatch",value:function(){this.toPatch(this.idCurrentPatch+1)}},{key:"beforePatch",value:function(){this.toPatch(this.idCurrentPatch-1)}},{key:"toPatch",value:function(e){e>=this.patchs.length?e=0:0>e&&(e=this.patchs.length-1),this.idCurrentPatch=e;var t=new Details(Details.TypeChange.PATCH_NUMBER,this.idCurrentPatch),n=new ChangeMessage(MultistompCause.MULTISTOMP,this,t);this.notify(n)}},{key:"patchs",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return patchs})},{key:"toString",value:function(){var t="";t+="Multistomp: "+e.name+"\n",t+=" - Current Patch: "+this.currentPatch().toString()+"\n",t+=" - Effects: \n";var n=!0,s=!1,a=void 0;try{for(var r,i=this.currentPatch().effects[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var o=r.value;t+="  |- "+o.toString()+"\n"}}catch(u){s=!0,a=u}finally{try{!n&&i["return"]&&i["return"]()}finally{if(s)throw a}}return t}},{key:"addListenner",value:function(e){this.listenners.push(e)}},{key:"listenners",value:function(){return this.listenners}},{key:"onChange",value:function(e){var t=new ChangeMessage(MultistompCause.SUPER,this,e);this.notify(t)}},{key:"notify",value:function(e){var t=MultistompMessagesConverter.convert(e);this.listenners.forEach(function(e){return e.onChange(t)})}},{key:"start",value:function(){}}]),e}(),MultistompMessagesConverter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"convert",value:function(e){var t=null,n=new Messages.Details;return e.is(MultistompCause.MULTISTOMP)?t=this.convertToPatch(e,n):e.is(MultistompCause.EFFECT)?t=this.convertStatusEffect(e,n):e.is(MultistompCause.PATCH)&&(t=this.convertSetParam(e,n)),null!=t?Messages.For(t):Messages.For()}},{key:"convertToPatch",value:function(e,t){return t.patch=e.causer.getIdCurrentPatch(),new Messages.Message(CommonCause.TO_PATCH,t)}},{key:"convertStatusEffect",value:function(e,t){var n=e.nextMessage.causer;t.patch=e.causer.patchs.indexOf(n);var s=e.realMessage().causer,a=n.effects.indexOf(s);t.effect=a;var r=s.hasActived()?CommonCause.ACTIVE_EFFECT:CommonCause.DISABLE_EFFECT;return new Messages.Message(r,t)}},{key:"convertSetParam",value:function(e,t){var n=e.nextMessage.causer,s=e.nextMessage.nextMessage.causer,a=n.effects.indexOf(s);return t.effect=a,t.param=s.params.indexOf(e.realMessage().causer),t.value=e.realMessage().causer.getValue(),new Messages.Message(CommonCause.SET_PARAM,t)}}]),e}(),Param=function(){function e(t,n,s,a,r){_classCallCheck(this,e),this.stepByStep=1,this.listenner=Optional.empty(),this.name=t,this.minValue=n,this.maxValue=s,this.setCurrentValue(a),this.stepByStep=r}return _createClass(e,[{key:"setCurrentValue",value:function(e){this.isValidValue(e)||(e=e>this.maxValue?this.maxValue:this.minValue),this.currentValue=e;var t=new Details(Details.TypeChange.PARAM,this.currentValue),n=new ChangeMessage(MultistompCause.PATCH,this,t);this.notify(n)}},{key:"isValidValue",value:function(e){return!(e<this.minValue||e>this.maxValue)}},{key:"notify",value:function(e){this.listenner.isPresent()&&this.listenner.get().onChange(e)}},{key:"getName",value:function(){return this.name}},{key:"getValue",value:function(){return this.currentValue}},{key:"setValue",value:function(e){this.setCurrentValue(e)}},{key:"addValue",value:function(){var e=this.currentValue+this.stepByStep;this.isValidValue(e)&&this.setValue(e)}},{key:"getMinValue",value:function(){return this.minValue}},{key:"getMaxValue",value:function(){return this.maxValue}},{key:"setListenner",value:function(e){this.listenner=Optional.of(e)}},{key:"toString",value:function(){return this.name+" = "+this.currentValue+" ["+this.minValue+" - "+this.maxValue+"]"}}]),e}(),Patch=function(){function e(t){_classCallCheck(this,e),this.name="",this.effects=new Array,this.listenner=Optional.empty(),this.id=t}return _createClass(e,[{key:"getId",value:function(){return id}},{key:"addEffect",value:function(e){this.effects.push(e),e.setListenner(this)}},{key:"setListenner",value:function(e){this.listenner=Optional.of(e)}},{key:"onChange",value:function(e){var t=new ChangeMessage(MultistompCause.SUPER,this,e);this.notify(t)}},{key:"notify",value:function(e){this.listenner.isPresent()&&this.listenner.get().onChange(e)}},{key:"toString",value:function(){return"Patch "+this.id+" - "+this.name+" ("+this.effects.length+") Effect(s))"}}]),e}(),ChangeMessage=function(){function e(t,n,s){_classCallCheck(this,e),this.nextMessage=null,s instanceof e?this._constructorMessage(t,n,s):this._constructorDetails(t,n,s)}return _createClass(e,null,[{key:"None",value:function(t){return new e<Multistomp>(MultistompCause.NONE,Details.NONE())}},{key:"For",value:function(t,n){return new e<Multistomp>(MultistompCause.MULTISTOMP,n)}},{key:"For",value:function(t,n,s){var a=new e<Patch>(MultistompCause.PATCH,s),r=new e<Multistomp>(MultistompCause.SUPER,a);return r}},{key:"For",value:function(t,n,s,a){var r=new e<Effect>(MultistompCause.EFFECT,a),i=new e<Patch>(MultistompCause.SUPER,r),o=new e<Multistomp>(MultistompCause.SUPER,i);return o}},{key:"For",value:function(t,n,s,a,r){var i=new e<Param>(MultistompCause.PARAM,r),o=new e<Effect>(MultistompCause.SUPER,i),u=new e<Patch>(MultistompCause.SUPER,o),l=new e<Multistomp>(MultistompCause.SUPER,u);return l}}]),_createClass(e,[{key:"_constructorMessage",value:function(e,t,n){this._constructorDetails(e,t,Details.NONE()),this.nextMessage=n}},{key:"_constructorDetails",value:function(e,t,n){this.cause=e,this.causer=t,this.details=n}},{key:"details",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return details})},{key:"is",value:function(e){return e===this.realMessage().cause}},{key:"realMessage",value:function(){for(var e=this;e.cause==MultistompCause.SUPER;)e=e.nextMessage;return e}},{key:"toString",value:function(){var e="";return e+=this.causer.getClass().getSimpleName(),e+=this.cause==MultistompCause.SUPER?" -> "+this.nextMessage.toString():" ("+this.cause.toString()+")"}}]),e}(),Details=function(){function e(t,n){_classCallCheck(this,e),this.type=t,this.newValue=n}return _createClass(e,null,[{key:"NONE",value:function(){return new e(e.TypeChange.NONE,0)}}]),_createClass(e,[{key:"newValue",value:function(){return this.newValue}},{key:"type",value:function(){return this.type}},{key:"toString",value:function(){return"("+this.type+" "+this.newValue+")"}}]),e}();Details.TypeChange={NONE:"NONE",PEDAL_STATUS:"PEDAL_STATUS",PARAM:"PARAM",PATCH_NUMBER:"PATCH_NUMBER"};var MultistompCause=function t(){_classCallCheck(this,t)};MultistompCause.SUPER="SUPER",MultistompCause.NONE="NONE",MultistompCause.MULTISTOMP="MULTISTOMP",MultistompCause.PATCH="PATCH",MultistompCause.EFFECT="EFFECT",MultistompCause.PARAM="PARAM";var Log=function(){function e(t){_classCallCheck(this,e),this.type=t}return _createClass(e,[{key:"onChange",value:function(e){var t=!0,n=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var i=a.value;console.info("LOG:: "+this.type),console.log("LOG:: "+i.toString())}}catch(o){n=!0,s=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw s}}}}]),e}(),MultistompSimulator=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);for(var n=0;e>n;n++){var s=new Patch(n),a=!0,r=!1,i=void 0;try{for(var o,u=this.genEffects()[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value;s.addEffect(l)}}catch(c){r=!0,i=c}finally{try{!a&&u["return"]&&u["return"]()}finally{if(r)throw i}}this.addPatch(s)}}return _inherits(t,e),_createClass(t,[{key:"genEffects",value:function(){var e=new Array;return e.push(this.genEffect(0,"Overdrive")),e.push(this.genEffect(1,"Reverb")),e.push(this.genEffect(2,"Chorus")),e}},{key:"genEffect",value:function(e,t){var n=new Effect(e,t);return n.addParam(new Param("Gain",0,50,0,1)),n.addParam(new Param("Volume",0,25,0,1)),n}},{key:"start",value:function(){return Messages.Empty()}},{key:"getPedalType",value:function(){return PedalType.Null}}]),t}(Multistomp),NullMultistomp=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.MSG_ERROR="Pedal Unknown is unimplemented",this.addPatch(new Patch(0)),console.log(this.MSG_ERROR)}return _inherits(t,e),_createClass(t,[{key:"getPedalType",value:function(){return PedalType.Null}},{key:"start",value:function(){return Messages.Empty()}}]),t}(Multistomp),ZoomMultistompFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"generate",value:function(e){return e==PedalType.G2Nu?new ZoomG2Nu:e==PedalType.G3?new ZoomGSeries(100,6,8):new ZoomGSeries(0,5,9)}}]),e}(),ZoomGSeries=function(e){function t(e,n,s){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.TOTAL_PATCHS=e,this.TOTAL_EFFECTS=n,this.SIZE_PARAMS=s;var a=this.createPatchs(this.TOTAL_PATCHS),r=!0,i=!1,o=void 0;try{for(var u,l=a[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;this.addPatch(c)}}catch(h){i=!0,o=h}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw o}}}return _inherits(t,e),_createClass(t,[{key:"createPatchs",value:function(e){for(var t=new Array,n=0;e>n;n++){var s=new Patch(n),a=!0,r=!1,i=void 0;try{for(var o,u=this.createEffects(this.TOTAL_EFFECTS)[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value;s.addEffect(l)}}catch(c){r=!0,i=c}finally{try{!a&&u["return"]&&u["return"]()}finally{if(r)throw i}}t.push(s)}return t}},{key:"createEffects",value:function(e){for(var t=new Array,n=0;e>n;n++)t.push(ZoomGSeriesEffect.COMP.generate());return t}},{key:"start",value:function(){var e=Messages.Empty();return e.concatWith(ZoomGSeriesMessages.LISSEN_ME()),e.concatWith(ZoomGSeriesMessages.YOU_CAN_TALK()),e}},{key:"getPedalType",value:function(){return PedalType.G3}}]),t}(Multistomp),ZoomGSeriesCause=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),t}(CommonCause);ZoomGSeriesCause.REQUEST_CURRENT_PATCH_NUMBER="REQUEST_CURRENT_PATCH_NUMBER",ZoomGSeriesCause.REQUEST_CURRENT_PATCH_DETAILS="REQUEST_CURRENT_PATCH_DETAILS",ZoomGSeriesCause.REQUEST_SPECIFIC_PATCH_DETAILS="REQUEST_SPECIFIC_PATCH_DETAILS",ZoomGSeriesCause.LISSEN_ME="LISSEN_ME",ZoomGSeriesCause.YOU_CAN_TALK="YOU_CAN_TALK",ZoomGSeriesCause.SET_EFFECT="SET_EFFECT";var ZoomGSeriesEffect=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"COMP",value:new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"generate",value:function(){var e=new Effect(0,this.constructor.name);return e.addParam(new Param("Sense",0,10,6,1)),e.addParam(new Param("Tone",0,10,6,1)),e.addParam(new Param("Level",0,150,100,1)),e.addParam(new Param("ATTCK",0,1,0,1)),e}}]),e}()),enumerable:!0}]),e}(),ZoomGSeriesMessageDecoder=function(){function e(){_classCallCheck(this,e),this.decoders=new Array,this.decoders.push(new ZoomGSeriesPatchDecoder),this.decoders.push(new ZoomGSeriesSelectPatchDecoder)}return _createClass(e,[{key:"isForThis",value:function(e){return this.decodeFor(e).isPresent()}},{key:"decode",value:function(e,t){var n=this.decodeFor(e);if(n.isPresent())return n.get().decode(e,t);throw new Error("The message isn't for this implementation")}},{key:"decodeFor",value:function(e){var t=!0,n=!1,s=void 0;try{for(var a,r=this.decoders[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var i=a.value;if(i.isForThis(e))return Optional.of(i)}}catch(o){n=!0,s=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw s}}return Optional.empty()}}]),e}(),ZoomGSeriesMessageEncoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"encode",value:function(e){var t=this,n=new Array;return e.get(CommonCause.TO_PATCH).forEach(function(e){return n.push(t.toPatch(e))}),e.get(CommonCause.ACTIVE_EFFECT).forEach(function(e){var s=t.statusEffect(e,CommonCause.ACTIVE_EFFECT);s.forEach(function(e){return n.push(e)})}),e.get(CommonCause.DISABLE_EFFECT).forEach(function(e){var s=t.statusEffect(e,CommonCause.DISABLE_EFFECT);s.forEach(function(e){return n.push(e)})}),e.get(CommonCause.SET_PARAM).forEach(function(e){return n.push(t.setParam(e))}),e.get(ZoomGSeriesCause.SET_EFFECT).forEach(function(e){return n.push(t.setEffect(e))}),e.get(ZoomGSeriesCause.REQUEST_CURRENT_PATCH_NUMBER).forEach(function(e){return n.push(t.requestCurrentPatchNumber(e))}),e.get(ZoomGSeriesCause.REQUEST_CURRENT_PATCH_DETAILS).forEach(function(e){return n.push(t.requestCurrentPatchDetails(e))}),e.get(ZoomGSeriesCause.REQUEST_SPECIFIC_PATCH_DETAILS).forEach(function(e){return n.push(t.requestSpecificPatchDetails(e))}),e.get(ZoomGSeriesCause.LISSEN_ME).forEach(function(e){return n.push(t.lissenMe())}),e.get(ZoomGSeriesCause.YOU_CAN_TALK).forEach(function(e){return n.push(t.youCanTalk())}),n}},{key:"toPatch",value:function(e){var t=192,n=e.details.patch;try{return[t,n]}catch(s){throw new Error(s)}}},{key:"statusEffect",value:function(t,n){var s=t.details.effect,a=n==CommonCause.ACTIVE_EFFECT,r=a?1:0;return this.group(this.lissenMe(),this.manupuleEffect(s,e.SET_STATUS,r))}},{key:"setParam",value:function(t){var n=t.details.effect,s=t.details.param,a=t.details.value;return this.manupuleEffect(n,s+e.PARAM_EFFECT,a)}},{key:"setEffect",value:function(t){var n=t.details.effect,s=t.details.value;return this.manupuleEffect(n,e.CHANGE_EFFECT,s)}},{key:"manupuleEffect",value:function(e,t,n){var s=n/128|0;return n%=128,this.customMessageFor([240,82,0,90,49,e,t,n,s,247])}},{key:"requestCurrentPatchNumber",value:function(e){return this.customMessageFor([240,82,0,90,51,247])}},{key:"requestCurrentPatchDetails",value:function(e){return this.customMessageFor([240,82,0,90,41,247])}},{key:"requestSpecificPatchDetails",value:function(e){var t=e.details().patch,n=[240,82,0,90,9,0,0,t,247];

return this.customMessageFor(n)}},{key:"lissenMe",value:function(){return this.customMessageFor([240,82,0,90,80,247])}},{key:"youCanTalk",value:function(){return this.customMessageFor([240,82,0,90,22,247])}},{key:"group",value:function(){var e=new Array,t=!0,n=!1,s=void 0;try{for(var a=arguments.length,r=Array(a),i=0;a>i;i++)r[i]=arguments[i];for(var o,u=r[Symbol.iterator]();!(t=(o=u.next()).done);t=!0){var l=o.value;e.push(l)}}catch(c){n=!0,s=c}finally{try{!t&&u["return"]&&u["return"]()}finally{if(n)throw s}}return e}},{key:"customMessageFor",value:function(e){try{return e}catch(t){throw new Error(t)}}}],[{key:"SET_STATUS",value:0,enumerable:!0},{key:"CHANGE_EFFECT",value:1,enumerable:!0},{key:"PARAM_EFFECT",value:2,enumerable:!0}]),e}(),ZoomGSeriesMessages=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"REQUEST_CURRENT_PATCH_NUMBER",value:function(){return Messages.For(new Messages.Message(ZoomGSeriesCause.REQUEST_CURRENT_PATCH_NUMBER))}},{key:"REQUEST_CURRENT_PATCH_DETAILS",value:function(){return Messages.For(new Messages.Message(ZoomGSeriesCause.REQUEST_CURRENT_PATCH_DETAILS))}},{key:"REQUEST_SPECIFIC_PATCH_DETAILS",value:function(e){var t=new Messages.Detals;return t.patch=e,Messages.For(new Messages.Message(ZoomGSeriesCause.REQUEST_SPECIFIC_PATCH_DETAILS,t))}},{key:"LISSEN_ME",value:function(){return Messages.For(new Messages.Message(ZoomGSeriesCause.LISSEN_ME))}},{key:"YOU_CAN_TALK",value:function(){return Messages.For(new Messages.Message(ZoomGSeriesCause.YOU_CAN_TALK))}},{key:"SET_EFFECT",value:function(e,t){var n=new Messages.Detals;return n.effect=e,n.value=t,Messages.For(new Messages.Message(ZoomGSeriesCause.SET_EFFECT,n))}}]),e}(),AbstractZoomGSeriesPatchDecoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isForThis",value:function(e){var t=new MidiMessageTester(e);return t.init().sizeIs(this.size()).test()}},{key:"size",value:function(){}},{key:"decode",value:function(e,t){for(var n=this.patches(),s=t.currentPatch().effects(),a=Messages.Empty(),r=0;r<n.length;r++){var i=n[r],o=this.hasActived(e,i);(this.refressAll()||o&&!s.get(r).hasActived())&&a.add(this.generateMessageFor(o,r))}return a}},{key:"refressAll",value:function(){}},{key:"patches",value:function(){}},{key:"generateMessageFor",value:function(e,t){var n=e?CommonCause.ACTIVE_EFFECT:CommonCause.DISABLE_EFFECT,s=new Details;return s.effect=t,new Messages.Message(n,s)}},{key:"hasActived",value:function(e,t){var n=1,s=e.getMessage()[t]&n;return 1==s}}]),e}(),ZoomGSeriesPatchDecoder=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"decode",value:function(e,n){var s=_get(Object.getPrototypeOf(t.prototype),"decode",this).call(this,e,n),a=e.getMessage()[t.PATCH];return s.forEach(function(e){return e.details().patch=a}),s}},{key:"size",value:function(){return 120}},{key:"patches",value:function(){return[11,24,38,52,65,79]}},{key:"refressAll",value:function(){return!0}}],[{key:"PATCH",value:7,enumerable:!0}]),t}(AbstractZoomGSeriesPatchDecoder),ZoomGSeriesSelectPatchDecoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isForThis",value:function(e){var t=[192],n=new MidiMessageTester(e);return n.init().sizeIs(2).startingWith(t).test()}},{key:"decode",value:function(t,n){var s=new Messages.Details;return s.patch=t[e.PATCH],Messages.For(new Messages.Message(CommonCause.TO_PATCH,s))}}],[{key:"PATCH",value:1,enumerable:!0}]),e}();